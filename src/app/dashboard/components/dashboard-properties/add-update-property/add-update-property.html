<app-top-section [ownerNationalId]="ownerNationalId"></app-top-section>


<p-card header="إضافة عقار جديد" class="mb-4">
    <form class="row g-3" [formGroup]="form" (ngSubmit)="onSubmit()">

        @if(mode == enMode.Add) {
        @if (form.get('ownerNationalId')?.hasError('existsCustomer') &&
        form.get('ownerNationalId')?.dirty) {
        <p-message severity="error" icon="pi pi-times-circle" text="الرقم الوطني غير مسجل في النظام"
            [closable]="false"></p-message>
        }
        @if (hasValue('title')) {
        <p-message severity="error" icon="pi pi-times-circle" text="عنوان العقار مطلوب" [closable]="false"></p-message>
        }


        @if (form.get('ownerNationalId')?.hasError('required') &&
        form.get('ownerNationalId')?.touched) {
        <p-message severity="error" icon="pi pi-times-circle" text="الرقم الوطني للمالك مطلوب"
            [closable]="false"></p-message>
        }
        }

        @if (hasValue('categoryId')) {
        <p-message severity="error" icon="pi pi-times-circle" text="الصنف مطلوب" [closable]="false"></p-message>
        }
        @if (hasValue('price')) {
        <p-message severity="error" icon="pi pi-times-circle" text="السعر مطلوب" [closable]="false"></p-message>
        }
        @if (hasValue('area')) {
        <p-message severity="error" icon="pi pi-times-circle" text="المساحة مطلوبة" [closable]="false"></p-message>
        }
        @if (hasValue('location')) {
        <p-message severity="error" icon="pi pi-times-circle" text="الموقع العام مطلوب" [closable]="false"></p-message>
        }
        @if (hasValue('address')) {
        <p-message severity="error" icon="pi pi-times-circle" text="العنوان مطلوب" [closable]="false"></p-message>
        }
        <p-message severity="error" icon="pi pi-times-circle" [life]="3000" text="حدث خطأ ما يرجى المحاولة مرة اخرى"
            [closable]="false"></p-message>




        <div class="col-md-6">
            <label for="title" class="form-label">اسم العقار</label>
            <input id="title" type="text" formControlName="title" pInputText class="w-100 p-2"
                placeholder="أدخل عنوان العقار" />

        </div>

        @if(mode == enMode.Add) {

        <div class="col-md-6">
            <label for="ownerNationalId" class="form-label">المالك</label>
            <input id="ownerNationalId" type="text" formControlName="ownerNationalId" pInputText class="w-100 p-2"
                placeholder="أدخل الرقم الوطني المالك" />
        </div>
        }

        <div class="col-md-6">
            <label for="categoryId" class="form-label">الصنف</label>
            <p-select [options]="categories" placeholder="اختر التصنيف" formControlName="categoryId"
                class="w-100"></p-select>

        </div>

        <div class="col-md-6">
            <label for="price" class="form-label">السعر</label>
            <p-inputNumber inputId="price" formControlName="price" class="w-100" inputStyleClass="p-2"></p-inputNumber>

        </div>

        <div class="col-md-6">
            <label for="area" class="form-label">المساحة (م²)</label>
            <p-inputNumber inputId="area" formControlName="area" class="w-100" inputStyleClass="p-2"></p-inputNumber>

        </div>

        <div class="col-md-6">
            <label for="location" class="form-label">الموقع العام</label>
            <input id="location" type="text" formControlName="location" pInputText class="w-100 p-2"
                placeholder="الموقع العام" />

        </div>

        <div class="col-md-6">
            <label for="address" class="form-label">العنوان</label>
            <input id="address" type="text" formControlName="address" pInputText class="w-100 p-2"
                placeholder="العنوان" />

        </div>

        <div class="col-12">
            <label for="description" class="form-label">الوصف</label>
            <textarea id="description" formControlName="description" rows="3" pInputTextarea class="w-100 p-2"
                placeholder="أدخل وصف العقار"></textarea>
        </div>

        <div class="col-md-6">
            <div>
                <label for="imageUpload" class="form-label fw-semibold mb-2">رفع صور العقار</label>
                <p-message severity="error" text="يجب ارفاق صورة واحدة على الأقل" [closable]="false"
                    *ngIf="!imageUpload?.files?.length"></p-message>
            </div>

            <p-fileUpload #imageUpload name="images" val accept="image/*" [maxFileSize]="5000000" mode="advanced"
                [auto]="false" (onRemove)="onRemove($event)" chooseLabel="اختر صور" uploadLabel="رفع الصور"
                [showCancelButton]="false" [showUploadButton]="false" [multiple]="true" styleClass="custom-fileupload"
                (onSelect)="onImagesSelected($event)">
            </p-fileUpload>

        </div>

        <div class="col-md-6">
            <label for="videoUpload" class="form-label fw-semibold mb-2">(اختياري) رفع فيديو للعقار</label>

            <p-fileUpload #videoUpload name="video" accept="video/*" [maxFileSize]="5000000" mode="advanced"
                [auto]="false" chooseLabel="اختر فيديو" uploadLabel="رفع الفيديو" [showCancelButton]="false"
                [showUploadButton]="false" styleClass="custom-fileupload" (onSelect)="onVideoSelected($event)">
            </p-fileUpload>
        </div>

        <div class="col-6 mx-auto my-5">
            <button pButton type=" submit" [disabled]="disabledSubmit" label="إضافة العقار"
                class="p-button-success w-100"></button>
        </div>
    </form>
</p-card>