<section class="card rounded-4 shadow-sm border-0 bg-white mb-5 mt-3 p-0">
    <!-- رأس القسم -->
    <header class="d-flex gap-2 align-items-center mb-4">
        <h1 class="h5 fw-semibold text-dark m-0">قائمة الفئات</h1>
    </header>

    <!-- جدول الفئات -->
    <div class="table-responsive">
        <p-table [value]="filteredCategories" [totalRecords]="totalRecords" [lazy]="true"
            (onLazyLoad)="loadCategories($event)" [loading]="loading"
            styleClass="p-datatable-sm rounded-3 overflow-hidden shadow-none bg-white" responsiveLayout="scroll">

            <!-- رأس الجدول -->
            <ng-template pTemplate="header">
                <tr class="bg-light text-muted">
                    <th class="px-4 py-3 fw-semibold text-nowrap">#</th>
                    <th class="px-4 py-3 fw-semibold text-nowrap">أسم الفئة</th>
                    <th class="px-4 py-3 fw-semibold text-nowrap">عدد العقارات</th>
                    <th class="px-4 py-3 fw-semibold text-center" style="width: 180px;">الإجراءات</th>
                </tr>
            </ng-template>

            <!-- بيانات الجدول -->
            <ng-template pTemplate="body" let-category let-i="rowIndex">
                <tr>
                    <td class="px-4 py-3">{{ i + 1 }}</td>
                    <td class="px-4 py-3 fw-medium">{{ category.categoryName }}</td>
                    <td class="px-4 py-3">
                        <span class="badge bg-primary">{{ category.propertiesCount }}</span>
                    </td>
                    <td class="px-4 py-3 text-center">
                        <button class="btn btn-sm text-primary"
                            (click)="showUpdateCategoryDialog(category.categoryId,category.categoryName)">
                            <i class="pi pi-pencil"></i>
                        </button>
                        <button class="btn btn-sm text-danger" (click)="confirmDelete($event, category.categoryId)">
                            <i class="pi pi-trash"></i>
                        </button>
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <div *ngIf="!filteredCategories || filteredCategories.length === 0" class="text-center py-4">
            <h3 class="text-muted mb-0">لا يوجد فئات</h3>
        </div>
    </div>
</section>



<p-confirmdialog />



<p-dialog header="إضافة فئة جديدة" styleClass="" [(visible)]="visible" [style]="{ width: '25rem'  }">
    @for (error of errors ; track $index) {
    <p-message severity="error" styleClass="mt-4" icon="pi pi-times-circle " text="{{error}}" [closable]="false"
        [life]="6000" variant="outlined"></p-message>
    }
    <div class="flex items-center gap-4 my-3">
        <p-floatlabel variant="on">
            <input pInputText id="on_label" [(ngModel)]="categoryName" [ngStyle]="{ width: '100%' }"
                autocomplete="off" />
            <label for="on_label" class="me-3">اسم الفئة</label>
        </p-floatlabel>
    </div>
    <div class="d-flex justify-end gap-2">
        <p-button label="حفظ" (click)="updateCategory()" />
        <p-button label="إلغاء" severity="secondary" (click)="closeDialog()" />
        <!-- newCategoryName -->
    </div>
</p-dialog>